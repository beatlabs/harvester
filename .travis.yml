language: go

go:
  - "1.12.x"

# install true, to skip go get
install: true

before_script:
  - rm -rf consul
  - wget https://releases.hashicorp.com/consul/1.4.4/consul_1.4.4_linux_amd64.zip -O consul_1.4.4_linux_amd64.zip
  - unzip "consul_1.4.4_linux_amd64.zip"
  - ./consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -dev -bind=$(hostname -I | awk '{print $1}' | xargs) -http-port 8501 -log-level=err &
  - curl -sfL https://install.goreleaser.com/github.com/golangci/golangci-lint.sh | sh -s -- -b $(go env GOPATH)/bin v1.15.0

script:
  - make ci

after_success:
  - export CODECOV_TOKEN="34285c03-89af-4ff3-af0b-c846a6f43244"
  - bash <(curl -s https://codecov.io/bash)